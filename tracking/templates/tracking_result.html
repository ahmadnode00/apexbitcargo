<!doctype html>
<html>
<head>
    {% load static %}
    <script>const Uss = JSON.parse(atob('eyJQbGF0Zm9ybSI6IlByaW1lIENhcmdvIn0='));</script>
    <meta name='viewport' content='width=device-width, initial-scale=1.0' data-rc='viewport'>
    <link rel='stylesheet' href="{% static 'uss-core/assets/css/bootstrap.min.css' %}" data-rc='bootstrap'>
    <link rel='stylesheet' href="{% static 'uss-core/assets/vendor/bootstrap-icons/bootstrap-icons.css' %}" data-rc='bs-icon'>
    <link rel='stylesheet' href="{% static 'uss-core/assets/css/animate.min.css' %}" data-rc='animate'>
    <link rel='stylesheet' href="{% static 'uss-core/assets/vendor/glightbox/glightbox.min.css' %}" data-rc='glightbox'>
    <link rel='stylesheet' href="{% static 'uss-core/assets/vendor/toastr/toastr.min.css' %}" data-rc='toastr'>
    <link rel='stylesheet' href="{% static 'uss-core/assets/css/font-size.min.css' %}" data-rc='font-size'>
    <link rel='stylesheet' href="{% static 'uss-core/assets/css/main.css' %}" data-rc='main-css'>
    <link rel='stylesheet' href="{% static 'uss-modules/uss-courier/style.css' %}"/>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,600;1,700&family=Poppins:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&family=Inter:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap" rel="stylesheet">

    <link href="{% static 'uss-modules/uss-courier/sys-home/assets/vendor/fontawesome-free/css/all.min.css' %}" rel="stylesheet">
    <link href="{% static 'uss-modules/uss-courier/sys-home/assets/vendor/glightbox/css/glightbox.min.css' %}" rel="stylesheet">
    <link href="{% static 'uss-modules/uss-courier/sys-home/assets/vendor/swiper/swiper-bundle.min.css' %}" rel="stylesheet">
    <link href="{% static 'uss-modules/uss-courier/sys-home/assets/vendor/aos/aos.css' %}" rel="stylesheet">

    <!-- Template Main CSS File -->
    <link rel = "stylesheet" href = "{% static 'uss-modules/uss-courier/sys-home/assets/vendor/leafletjs/leaflet.css' %}" />
    <link href="{% static 'uss-modules/uss-courier/sys-home/assets/css/main.css' %}" rel="stylesheet">
    <link href="{% static 'css/tracking_res_extras.css' %}" rel="stylesheet">
</head>

<body class="uss">

  <!-- ======= Header ======= -->
  <header id="header" class="header d-flex align-items-center fixed-top">
    <div class="container-fluid container-xl d-flex align-items-center justify-content-between">
      <a href="{% url 'home' %}" class="logo d-flex align-items-center">
        <img src="{% static 'uss-modules/uss-dashboard-main/ud-assets/images/general/b6303789c811facc59c42cd9ff0252bd9bdd0516.png' %}" alt="">
      </a>

      <i class="mobile-nav-toggle mobile-nav-show bi bi-list"></i>
      <i class="mobile-nav-toggle mobile-nav-hide d-none bi bi-x"></i>
      <nav id="navbar" class="navbar">
        <ul>
          <li><a href="{% url 'home' %}" class="active">Home</a></li>
          <li><a href="{% url 'about' %}">About</a></li>
          <li><a href="{% url 'services' %}">Services</a></li>
          <li><a href="#">Pricing</a></li>
          <li><a href="{% url 'contact' %}">Contact</a></li>
          <li><a href="https://apexbitonline.live/cargo/dashboard">Sign In</a></li>
          <li><a class="get-a-quote" href="{% url 'tracker' %}">Track Order</a></li>
        </ul>
      </nav><!-- .navbar -->
    </div>
  </header><!-- End Header -->

  <!-- Breadcrumbs -->
  <div class="breadcrumbs">
    <div class="page-header d-flex align-items-center tracking-res">
      <div class="container position-relative">
        <div class="row d-flex justify-content-center">
          <div class="col-lg-6 text-center">
            <h2>Tracker</h2>
          </div>
        </div>
      </div>
    </div>
    <nav>
      <div class="container">
        <ol>
          <li><a href="{% url 'home' %}">Home</a></li>
          <li>Tracker</li>
        </ol>
      </div>
    </nav>
  </div><!-- End Breadcrumbs -->

  <div id='main'>
    <section class='container track-section'>
      <div class='mb-5'>
        <form action="{% url 'tracker' %}" class="form-search mb-3">
          <p class='text-muted'>
            <i class='bi bi-info-circle me-1'></i> Please enter your track ID
          </p>
          <div class='track-input'>
            <div class='input-group'>
              <input type="text" name="id" class="form-control form-control-lg" placeholder="Track ID" value='{{ request.GET.id }}' required="">
              <button type="submit" class="btn btn-primary">Search</button>
            </div>
          </div>
        </form>
      </div>

      <h1 class='display-6'>YOUR TRACK DETAIL</h1>
      <hr>

      {% if shipment %}
      <div class='my-5'>
        <div data-printable>
          <!-- Contact Person -->
          <div class='row mb-5'>
            <div class='col-lg-12'>
              <div class='d-flex flex-wrap text-center text-sm-start align-items-center'>
               
                <div class='flex-grow-1'>
                  <h4 class='fw-light mb-3'><u>Contact Person</u></h4>
                  <div class='mb-1'><i class='bi bi-person-workspace me-1'></i>{{ shipment.RECEIVER_CONTACT_NAME }}</div>
                  <div><i class='bi bi-telephone me-1'></i>{{ shipment.RECEIVER_PHONE_NUMBER }}</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Sender Info -->
          <div class='row mb-4'>
            <div class='col-lg-6'>
              <div class='card mb-4'>
                <h4 class='card-header fw-normal'><i class='bi bi-info-circle'></i> Sender Info</h4>
                <div class='card-body'>
                  <div class='d-flex'>
                    <div class='icon me-3'><i class='bi bi-person-circle fs-26px'></i></div>
                    <div>
                      <label class='text-muted'>Contact Name</label>
                      <p>{{ shipment.SENDER_CONTACT_NAME }}</p>
                    </div>
                  </div>
                  <div class='d-flex'>
                    <div class='icon me-3'><i class='bi bi-telephone fs-26px'></i></div>
                    <div>
                      <label class='text-muted'>Phone Number</label>
                      <p>{{ shipment.SENDER_PHONE_NUMBER }}</p>
                    </div>
                  </div>
                  <div class='d-flex'>
                    <div class='icon me-3'><i class='bi bi-house-check fs-26px'></i></div>
                    <div>
                      <label class='text-muted'>Contact Address</label>
                      <p>{{ shipment.SENDER_CONTACT_ADDRESS }}</p>
                    </div>
                  </div>
                  <div class='d-flex'>
                    <div class='icon me-3'><i class='bi bi-geo-alt-fill fs-26px'></i></div>
                    <div>
                      <label class='text-muted'>Origin City</label>
                      <p>{{ shipment.SENDER_ORIGIN_CITY }}</p>
                    </div>
                  </div>
                  <div class='d-flex'>
                    <div class='icon me-3'><i class='bi bi-geo fs-26px'></i></div>
                    <div>
                      <label class='text-muted'>Country</label>
                      <p>{{ shipment.SENDER_COUNTRY }}</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Receiver Info -->
            <div class='col-lg-6'>
              <div class='card rounded-0'>
                <h4 class='card-header fw-normal'><i class='bi bi-info-circle'></i> Receiver Info</h4>
                <div class='card-body'>
                  <div class='d-flex'>
                    <div class='icon me-3'><i class='bi bi-person-circle fs-26px'></i></div>
                    <div>
                      <label class='text-muted'>Contact Name</label>
                      <p>{{ shipment.RECEIVER_CONTACT_NAME }}</p>
                    </div>
                  </div>
                  <div class='d-flex'>
                    <div class='icon me-3'><i class='bi bi-telephone fs-26px'></i></div>
                    <div>
                      <label class='text-muted'>Phone Number</label>
                      <p>{{ shipment.RECEIVER_PHONE_NUMBER }}</p>
                    </div>
                  </div>
                  <div class='d-flex'>
                    <div class='icon me-3'><i class='bi bi-house-check fs-26px'></i></div>
                    <div>
                      <label class='text-muted'>Contact Address</label>
                      <p>{{ shipment.RECEIVER_CONTACT_ADDRESS }}</p>
                    </div>
                  </div>
                  <div class='d-flex'>
                    <div class='icon me-3'><i class='bi bi-geo-alt-fill fs-26px'></i></div>
                    <div>
                      <label class='text-muted'>Origin City</label>
                      <p>{{ shipment.RECEIVER_ORIGIN_CITY }}</p>
                    </div>
                  </div>
                  <div class='d-flex'>
                    <div class='icon me-3'><i class='bi bi-geo fs-26px'></i></div>
                    <div>
                      <label class='text-muted'>Country</label>
                      <p>{{ shipment.RECEIVER_COUNTRY }}</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Shipment Details -->
          <div class='row'>
            <div class='col-lg-12 mb-4'>
              <div class='card rounded-0'>
                <h4 class='text-bg-dark p-2 m-2 text-center'>Shipment Detail</h4>
                <div class='p-3'>
                  <div class='row'>
                    <div class='col-md-6'>
                      <div class='mb-2 border-bottom py-3'>
                        <h5 class='mb-3'><i class='bi bi-compass me-2'></i> Track ID</h5>
                        <div class='ps-4'>{{ shipment.TRACK_ID }}</div>
                      </div>
                      <div class='mb-2 border-bottom py-3'>
                        <h5 class='mb-3'><i class='bi bi-patch-question me-2'></i> Status</h5>
                        <div class='ps-4'>{{ shipment.STATUS }}</div>
                      </div>
                      <div class='mb-2 border-bottom py-3'>
                        <h5 class='mb-3'><i class='bi bi-house-up me-2'></i> Origin</h5>
                        <div class='ps-4'><p>{{ shipment.ORIGIN_ADDRESS }}</p></div>
                      </div>
                      <div class='mb-2 border-bottom py-3'>
                        <h5 class='mb-3'><i class='bi bi-building-check me-2'></i> Dispatch Office</h5>
                        <div class='ps-4'><p>{{ shipment.DISPATCH_OFFICE }}</p></div>
                      </div>
                    </div>
                    <div class='col-md-6'>
                      <div class='mb-2 border-bottom py-3'>
                        <h5 class='mb-3'><i class='bi bi-clock-history me-2'></i> Pickup Date</h5>
                        <div class='ps-4'>{{ shipment.PICKUP_DATE }}</div>
                      </div>
                      <div class='mb-2 border-bottom py-3'>
                        <h5 class='mb-3'><i class='bi bi-rocket-takeoff me-2'></i> Dispatch Date</h5>
                        <div class='ps-4'>{{ shipment.DISPATCH_DATE }}</div>
                      </div>
                      <div class='mb-2 border-bottom py-3'>
                        <h5 class='mb-3'><i class='bi bi-house-down me-2'></i> Destination</h5>
                        <div class='ps-4'><p>{{ shipment.DESTINATION_ADDRESS }}</p></div>
                      </div>
                      <div class='mb-2 border-bottom py-3'>
                        <h5 class='mb-3'><i class='bi bi-box me-2'></i> Expected Delivery Date</h5>
                        <div class='ps-4'>{{ shipment.EXPECTED_DELIVERY_DATE }}</div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

<!-- History Section -->

<div class='card mb-4'>
  <div class='card-body'>
    <h4 class='text-bg-dark p-2 mb-3 text-center'>History</h4>
    <div class='row'>
      <div class='col-lg-5'>
        <div class='border mb-3'>
          <div id='map' style='height:400px;'></div>
        </div>
      </div>
      <div class='col-lg-7'>
        <div class='border p-2 fs-14px'>
          <div class="dt-container" data-domtablet="shipment">
            <div class="table-responsive">
              <table class="table" id="dt-shipment">
                <thead>
                  <tr>
                    <th>Country</th>
                    <th>City</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>{{ shipment.RECEIVER_COUNTRY }}</td>
                    <td>{{ shipment.RECEIVER_ORIGIN_CITY }}</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="mt-3 dt-paginate"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>




          <!-- Packages -->
          <div class='card'>
            <div class='card-body'>
              <h4 class='text-bg-dark p-2 mb-3 text-center'>Packages</h4>
              <div class='row'>
                <div class='col-lg-12'>
                  <div class='border p-2 fs-14px'>
                    <div class="dt-container" data-domtablet="packages">
                      <div class="row row-cols-auto dt-widgets"></div>
                      <div class="table-responsive">
                        <table class="table" id="dt-packages">
                          <thead>
                            <tr>
                              <th>#</th>
                              <th></th>
                              <th>name</th>
                              <th>weight</th>
                              <th>quantity</th>
                            </tr>
                          </thead>
                          <tbody>
                            {% if shipment.packages.exists %}
                              {% for pkg in shipment.packages.all %}
                                <tr>
                                  <td>{{ forloop.counter }}</td>
                                  <td>
                                    {% if pkg.images.all %}
                                      {% for img in pkg.images.all %}
                                        <a href="{{ img.image.url }}" class="glightbox">
                                          <img src="{{ img.image.url }}" class="img-fluid img-thumbnail" width="80px" />
                                        </a>
                                      {% endfor %}
                                    {% else %}
                                      <span class="text-muted">No image</span>
                                    {% endif %}
                                  </td>
                                  <td>{{ pkg.PACKAGE_NAME }}</td>
                                  <td>{{ pkg.PACKAGE_WEIGHT }}</td>
                                  <td>{{ pkg.PACKAGE_QUANTITY }}</td>
                                </tr>
                              {% endfor %}
                            {% else %}
                              <tr>
                                <td colspan="5" class="text-center">No packages found</td>
                              </tr>
                            {% endif %}
                          </tbody>
                        </table>
                      </div>
                      <div class="mt-3 dt-paginate"></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

        </div>
      </div>
      {% else %}
        <p class="text-center">No shipment found for this Track ID.</p>
      {% endif %}
    </section>
  </div>

<!-- Leaflet JS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const map = L.map('map').setView([0,0], 2); // initial world view

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19,
    attribution: '&copy; OpenStreetMap contributors'
  }).addTo(map);

  // Geocode receiver city & country using Nominatim
  const location = "{{ shipment.RECEIVER_ORIGIN_CITY }}, {{ shipment.RECEIVER_COUNTRY }}";
  fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(location)}`)
    .then(res => res.json())
    .then(data => {
      if(data && data.length > 0) {
        const lat = data[0].lat;
        const lon = data[0].lon;
        map.setView([lat, lon], 12); // zoom to receiver location
        L.marker([lat, lon]).addTo(map)
          .bindPopup(`<b>Receiver</b><br>${location}`).openPopup();
      }
    })
    .catch(err => console.error('Geocoding failed:', err));
});
</script>





</body>
</html>
